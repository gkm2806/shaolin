{"version":3,"sources":["../../src/routers/locais.js"],"names":["LocalRouter","express","Router","route","get","req","res","Local","find","err","locais","json","post","local","body","console","log","save","status","send","deleteMany","findOne","_id","params","LocalId","findUser","_doc","patch","p","deleteOne","then","sendStatus","put","newBeacon","beacon","id","update","findOneAndUpdate","BeaconId","beaconLocals"],"mappings":"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","sourcesContent":["import express from 'express';\nimport Local from '../models/local';\nimport moment from \"moment\"\n\nconst LocalRouter = express.Router();\n\nLocalRouter.route('/')\n    .get((req, res) => {\n        Local.find({}, (err, locais) => {\n            res.json(locais)\n        })\n    })\n    .post(async (req, res) => {\n        let local = new Local(req.body);\n        console.log(\"req: \", req.body)\n        console.log(\"Local: \", local)\n        local.save()\n        res.status(201).send(local)\n    })\nLocalRouter.route('/DELETEALL')\n    .get((req, res) => {\n        Local.deleteMany({}, () => {\n            res.send(\"deletado\")\n        })\n    })\nLocalRouter.route('/:LocalId')\n    .get(async (req, res) => {\n        let findUser = await Local.findOne({ _id: req.params.LocalId })\n        if (!findUser) res.status(400).send(\"No Local found with this id\")\n        console.log(findUser._doc)\n        res.status(200).send(findUser._doc)\n    })\n    .patch((req, res) => {\n        if (req.body._id) {\n            delete req.body._id;\n        }\n        for (let p in req.body) {\n            req.local[p] = req.body[p]\n        }\n        req.local.save()\n        res.json(req.local)\n    })\n    .delete(async(req, res) => {\n        try{\n            await Local.deleteOne({_id: req.params.LocalId})\n                .then(()=>\n                    res.sendStatus(200)\n                ).catch(()=>\n                    res.sendStatus(400)\n                )\n        }catch(e){\n            res.send(e)\n        }\n    });\n/***************  B E A C O N S ****************/\n\nLocalRouter.route('/:LocalId/beacon')\n    .put(async (req, res) => {\n        var newBeacon = req.body.beacon;\n        var id = req.params.LocalId;\n\n        var update = { beacon: newBeacon };\n        Local.findOneAndUpdate({ \"_id\": id }, update, { new: true }).then((local)=>{\n            res.status(202).send(local)\n        }).catch(()=>{\n            res.status(400)\n        })\n    })\n\nLocalRouter.route('/beacons/:BeaconId')\n    .get(async (req, res) => {\n        let beaconLocals = await Local.find({ beacon: req.params.BeaconId })\n        \n        if (!beaconLocals) res.status(400).send(\"No local found within this beacon range\")\n        console.log(beaconLocals)\n        res.status(200).send(beaconLocals)\n    })\n\nexport default LocalRouter"],"file":"locais.js"}